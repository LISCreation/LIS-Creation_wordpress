(function(a){a.PluginManager.add("wptadv",function(b){var c=(!b.settings.wpautop&&b.settings.tadv_noautop);function d(e){var f="table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary";e=e.replace(new RegExp("<(?:"+f+")(?: [^>]*)?>","gi"),"\n$&");e=e.replace(new RegExp("</(?:"+f+")>","gi"),"$&\n");e=e.replace(/(<br(?: [^>]*)?>)[\r\n\t]*/gi,"$1\n");e=e.replace(/>\n[\r\n\t]+</g,">\n<");e=e.replace(/^<li/gm,"\t<li");e=e.replace(/<td>\u00a0<\/td>/g,"<td>&nbsp;</td>");return a.trim(e)}b.addCommand("Tadv_Mark",function(){b.formatter.toggle("mark")});b.addButton("tadv_mark",{icon:"backcolor",tooltip:"Mark",cmd:"Tadv_Mark",stateSelector:"mark"});b.on("init",function(){if(c){b.on("SaveContent",function(f){f.content=f.content.replace(/caption\](\s|<br[^>]*>|<p>&nbsp;<\/p>)*\[caption/g,"caption] [caption");f.content=f.content.replace(/<(object|audio|video)[\s\S]+?<\/\1>/g,function(g){return g.replace(/[\r\n\t ]+/g," ")});f.content=f.content.replace(/<pre( [^>]*)?>[\s\S]+?<\/pre>/g,function(g){g=g.replace(/<br ?\/?>(\r\n|\n)?/g,"\n");return g.replace(/<\/?p( [^>]*)?>(\r\n|\n)?/g,"\n")});f.content=d(f.content)})}try{if(b.plugins.searchreplace&&!b.controlManager.buttons.searchreplace){b.shortcuts.remove("meta+f")}}catch(e){}b.formatter.register({mark:{inline:"mark"}})});if(c){b.on("beforeSetContent",function(e){var f=typeof window.wp!=="undefined"&&window.wp.editor&&window.wp.editor.autop;if(e.load&&f&&e.content&&e.content.indexOf("\n")>-1&&!/<p>/i.test(e.content)){e.content=f(e.content)}},true)}return{addLineBreaks:d}})}(window.tinymce));